# Makefile para compilar kernel de an√°lisis de secuencias
CC = gcc
CFLAGS = -Wall -Wextra -O3 -fPIC
LDFLAGS = -shared

# Detectar plataforma autom√°ticamente
UNAME_S := $(shell uname -s)

# Configuraci√≥n espec√≠fica por plataforma
ifeq ($(UNAME_S),Linux)
    TARGET = sequence_analyzer.so
    CFLAGS += -std=c99
endif

ifeq ($(UNAME_S),Darwin)
    TARGET = sequence_analyzer.dylib
    LDFLAGS += -undefined dynamic_lookup
    CFLAGS += -std=c99
endif

ifeq ($(OS),Windows_NT)
    TARGET = sequence_analyzer.dll
    CC = gcc
endif

# Archivos fuente
SOURCE = sequence_analyzer.c
OBJECTS = sequence_analyzer.o

# Regla principal
all: $(TARGET)

$(TARGET): $(OBJECTS)
	$(CC) $(LDFLAGS) -o $(TARGET) $(OBJECTS)
	@echo "‚úÖ Kernel compilado exitosamente: $(TARGET)"

$(OBJECTS): $(SOURCE)
	$(CC) $(CFLAGS) -c $(SOURCE)

# Limpieza
clean:
	rm -f $(OBJECTS) $(TARGET) *.so *.dylib *.dll
	@echo "üßπ Archivos de compilaci√≥n limpiados"

# Instalaci√≥n (copia a directorio padre para f√°cil acceso)
install: $(TARGET)
	cp $(TARGET) ../$(TARGET)
	@echo "üì¶ Kernel instalado en directorio padre"

# Test b√°sico
test: $(TARGET)
	@echo "üß™ Ejecutando test b√°sico..."
	@python3 -c "import ctypes; lib = ctypes.CDLL('./$(TARGET)'); print('Kernel cargado correctamente')" || echo "‚ùå Error cargando kernel"

# Informaci√≥n del sistema
info:
	@echo "üîç Informaci√≥n del sistema:"
	@echo "   Sistema: $(UNAME_S)"
	@echo "   Compilador: $(CC)"
	@echo "   Flags: $(CFLAGS)"
	@echo "   Target: $(TARGET)"

# Compilaci√≥n con debug
debug: CFLAGS += -g -DDEBUG
debug: $(TARGET)

# Ayuda
help:
	@echo "üõ†Ô∏è  Makefile para kernel de an√°lisis de secuencias"
	@echo ""
	@echo "Targets disponibles:"
	@echo "  all      - Compilar kernel (default)"
	@echo "  clean    - Limpiar archivos de compilaci√≥n"
	@echo "  install  - Instalar kernel en directorio padre"
	@echo "  test     - Ejecutar test b√°sico"
	@echo "  debug    - Compilar con s√≠mbolos de debug"
	@echo "  info     - Mostrar informaci√≥n del sistema"
	@echo "  help     - Mostrar esta ayuda"

.PHONY: all clean install test info debug help